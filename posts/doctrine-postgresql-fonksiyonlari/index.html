<!doctype html><html><head lang=en><meta name=lightning content="fallingwhimsy946296@getalby.com"><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Doctrine postgresql fonksiyonlari - emre.xyz | @delirehberi</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Symfony ile uygulama geliştirirken tüm veritabanı işlemleri Doctrine üzerinden gerçekleştiriliyor. Doctrine ise tüm veritabanlarına ortada durabilmek adına maksimum ortak paydaya ulaşarak buna uygun programlanıyor.
Yani bir özellik geliştirileceği zaman, en optimum şekilde, tüm veritabanlarına uyacak kadarını geliştiriyorlar. Bu sebeple PostgreSQL&rsquo;in pek çok güzel özelliği içerisinde gelmiyor."><meta property="og:image" content><meta property="og:url" content="https://blog.emre.xyz/posts/doctrine-postgresql-fonksiyonlari/"><meta property="og:site_name" content="emre.xyz | @delirehberi"><meta property="og:title" content="Doctrine postgresql fonksiyonlari"><meta property="og:description" content="Symfony ile uygulama geliştirirken tüm veritabanı işlemleri Doctrine üzerinden gerçekleştiriliyor. Doctrine ise tüm veritabanlarına ortada durabilmek adına maksimum ortak paydaya ulaşarak buna uygun programlanıyor.
Yani bir özellik geliştirileceği zaman, en optimum şekilde, tüm veritabanlarına uyacak kadarını geliştiriyorlar. Bu sebeple PostgreSQL’in pek çok güzel özelliği içerisinde gelmiyor."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-05-07T20:00:00-04:00"><meta property="article:modified_time" content="2020-05-07T20:00:00-04:00"><meta property="article:tag" content="Tr"><meta name=twitter:card content="summary"><meta name=twitter:title content="Doctrine postgresql fonksiyonlari"><meta name=twitter:description content="Symfony ile uygulama geliştirirken tüm veritabanı işlemleri Doctrine üzerinden gerçekleştiriliyor. Doctrine ise tüm veritabanlarına ortada durabilmek adına maksimum ortak paydaya ulaşarak buna uygun programlanıyor.
Yani bir özellik geliştirileceği zaman, en optimum şekilde, tüm veritabanlarına uyacak kadarını geliştiriyorlar. Bu sebeple PostgreSQL’in pek çok güzel özelliği içerisinde gelmiyor."><script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@1,500&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://blog.emre.xyz/css/main.6a0f23ea50fd34b46fee262a5a68e17d458c51a2bc99ba1ba018065de6b180c3.css><link rel=stylesheet type=text/css media=screen href=https://blog.emre.xyz/css/ext.a79633986a21ab3daf02e6ccca6c7d985b6facd4b7dd3520b0c50336cfde916b.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://blog.emre.xyz/css/dark.50b57e12d401420df23965fed157368aba37b76df0ecefd0b1ecd4da664f01a0.css disabled><script async src="https://www.googletagmanager.com/gtag/js?id=G-VLZVJMKPNJ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VLZVJMKPNJ")</script></head><body><div class=content><header><div class=main><a href=https://blog.emre.xyz/>emre.xyz | @delirehberi</a></div><nav><a href=/>main</a>
<a href=https://cal.emre.xyz>cal</a>
<a href=https://nostr.emre.xyz>nostr</a>
<a href=/til>til</a>
<a href=/about>me</a>
<a href=/subscribe>subscribe</a>
<a href=/resume.pdf>resume</a>
| <span id=dark-mode-toggle onclick=toggleTheme()><svg class="feather"><use href="https://unpkg.com/feather-icons@4.29.2/dist/feather-sprite.svg#sun"/></svg></span>
<script src=https://blog.emre.xyz/js/themetoggle.js></script><script src=https://unpkg.com/feather-icons></script><script type=text/javascript src=https://unpkg.com/zapthreads/dist/zapthreads.iife.js></script></nav></header><main><article><div class=post-container><div class=post-content><div class=title><h1 class=title>Doctrine postgresql fonksiyonlari</h1><div class=meta>Posted on May 7, 2020</div></div><section class=body><p>Symfony ile uygulama geliştirirken tüm veritabanı işlemleri Doctrine üzerinden gerçekleştiriliyor. Doctrine ise tüm veritabanlarına ortada durabilmek adına maksimum ortak paydaya ulaşarak buna uygun programlanıyor.</p><p>Yani bir özellik geliştirileceği zaman, en optimum şekilde, tüm veritabanlarına uyacak kadarını geliştiriyorlar. Bu sebeple PostgreSQL&rsquo;in pek çok güzel özelliği içerisinde gelmiyor.</p><p>Tabi ki <code>native sql</code> yazarak Doctrine içerisinden direkt saf PostgreSQL sorgusu çalıştırabiliyorsunuz. Fakat benim bahsetmek istediğim Doctrine&rsquo;in diğer bir güzel özelliği <code>kullanıcı tanımlı DQL fonksiyonları</code> kullanabiliyor olmak.</p><p>Çok detaya inmeden bahsetmek gerekirse; Doctrine SQL sorgularını yazılımcıdan DQL formatında talep edip, kendisi veritabanına uygun hale getirip SQL üretiyor. DQL formatında ise yukarıda bahsettiğim sebepten ötürü sadece belirli veritabanı özelliklerini destekleyebiliyor. Fakat DQL formatı genişletilebilir bir format olduğu için biz kendi DQL özelliklerimizi yazıp, Doctrine&rsquo;e kazandırabiliyoruz.</p><p>PostgreSQL fonksiyonlarını kullanabilmek için de bu özellikten yararlanacağız. Doctrine kendi<a href=https://www.doctrine-project.org/projects/doctrine-orm/en/2.7/cookbook/dql-user-defined-functions.html#dql-user-defined-functions>*</a> sitesinde çok güzel şekilde nasıl kendi DQL fonksiyonları yazabileceğinizi anlatmış.</p><p>Peki ben niye konuşuyorum?</p><p>Tabi ki <a href=https://github.com/martin-georgiev/postgresql-for-doctrine>Martin Georgiev</a>&lsquo;in zaten yazmış olduğu, PostgreSQL fonksiyonlarının DQL genişletmelerini içeren paketten bahsetmek için.</p><p>Composer ile paketi yükleyebiliyorsunuz.</p><p><code>composer require martin-georgiev/postgresql-for-doctrine</code></p><p>Sonrası ise kullanacağınız fonksiyonları, framework&rsquo;ünüze özel olarak tanımlamak kalıyor. Bu bir Doctrine paketi olduğu için Symfony bağımlı değil, diğer frameworklerle veya frameworksüz de kullanabilirsiniz.</p><p>Symfony 5 için aşağıdaki gibi tanımlayabiliyorsunuz:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>doctrine</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>dbal</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>types</span>: 
</span></span><span style=display:flex><span>          <span style=color:#f92672>text[]</span>: <span style=color:#ae81ff>MartinGeorgiev\Doctrine\DBAL\Types\TextArray</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>mapping_types</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>text[]</span>: <span style=color:#ae81ff>text[]</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>_text</span>: <span style=color:#ae81ff>text[]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>orm</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>dql</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>string_functions</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>ANY_OF</span>: <span style=color:#ae81ff>MartinGeorgiev\Doctrine\ORM\Query\AST\Functions\Any</span>
</span></span></code></pre></div><p>Sadece <code>text[]</code> türünü ve <code>ANY</code> fonksiyonunu yükledim bu örnekte. Tüm fonksiyon ve türler için <a href=https://github.com/martin-georgiev/postgresql-for-doctrine/blob/master/docs/INTEGRATING-WITH-SYMFONY.md>postgresql-for-doctrine</a> dökümanına göz atabilirsiniz.</p><p>Ayarlarınızı yaptıktan sonra ise kullanması kalıyor. Normalde her şeyi <code>Expr</code> ile oluşturmayı seviyorum ancak kullanıcı tanımlı bu fonksiyonlar için <code>Expr</code> ifadeleri bulunmuyor.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>    $qb <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createQueryBuilder</span>(<span style=color:#e6db74>&#39;u&#39;</span>);
</span></span><span style=display:flex><span>    $qb<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>andWhere</span>(<span style=color:#e6db74>&#34;:role &lt;&gt; ANY_OF(u.roles)&#34;</span>)
</span></span><span style=display:flex><span>       <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setParameter</span>(<span style=color:#e6db74>&#39;role&#39;</span>,<span style=color:#e6db74>&#39;ROLE_ADMIN&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $qb<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getQuery</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getResult</span>();
</span></span></code></pre></div><p>Yukarıda gördüğünüz gibi, sorgu olarak direkt kullanabiliyoruz.</p><p>Dikkat etmeniz gereken şey, PostgreSQL ifadelerinden bazıları DQL&rsquo;de aynı isimde geçmiyor. PostgreSQL&rsquo;de bulunan <code>ANY</code> ve <code>ALL</code> gibi fonksiyonları <code>ANY_OF</code> ve <code>ALL_OF</code> gibi DQL&rsquo;e geçmiş olmasının sebebi, zaten DQL içerisinde <code>ANY</code> ve <code>ALL</code> adında iki fonksiyonun bulunması. Ama tabi ki amaçları bambaşka.</p><div class=nostr-id><a href=https://njump.me/nevent1qvzqqqr4guq3gamnwvaz7tmjv4kxz7fwv4khyefw0puh5qgkwaehxw309aex2mrp0yhxummnw3ezucnpdejqz9rhwden5te0wfjkccte9ejxzmt4wvhxjmcprpmhxue69uhhyetvv9ujuumwdae8gtnnda3kjctvqyxhwumn8ghj7mn0wvhxcmmvqyt8wumn8ghj7un9d3shjtnswf5k6ctv9ehx2aqppamhxue69uhkummnw3ezumt0d5q3vamnwvaz7tmjv4kxz7fwdehhxtnnda3kjctvqyd8wumn8ghj7ctjw35kxmr9wvhxcctev4erxtnwv4mhxqg7waehxw309akkcuewv94kgetwd9azuetyw5h8gu30dehhxarjqqsyvtx675wwtgedmj49xq0pkk3wh6s57q7gvu0yx5f97vzx9ekz53cge2ewx>view in nostr/njump.me</a></div><zap-threads anchor=nevent1qvzqqqr4guq3gamnwvaz7tmjv4kxz7fwv4khyefw0puh5qgkwaehxw309aex2mrp0yhxummnw3ezucnpdejqz9rhwden5te0wfjkccte9ejxzmt4wvhxjmcprpmhxue69uhhyetvv9ujuumwdae8gtnnda3kjctvqyxhwumn8ghj7mn0wvhxcmmvqyt8wumn8ghj7un9d3shjtnswf5k6ctv9ehx2aqppamhxue69uhkummnw3ezumt0d5q3vamnwvaz7tmjv4kxz7fwdehhxtnnda3kjctvqyd8wumn8ghj7ctjw35kxmr9wvhxcctev4erxtnwv4mhxqg7waehxw309akkcuewv94kgetwd9azuetyw5h8gu30dehhxarjqqsyvtx675wwtgedmj49xq0pkk3wh6s57q7gvu0yx5f97vzx9ekz53cge2ewx relays='[ "wss://relay.emre.xyz", "wss://relay.nostr.band", "wss://relay.damus.io", "wss://relay.snort.social", "wss://nos.lol", "wss://relay.primal.net", "wss://nostr.mom", "wss://relay.nos.social", "wss://articles.layer3.news", "wss://mls.akdeniz.edu.tr/nostr"]'></section><div class=post-tags></div></div></div></article></main><footer><div style=display:flex><a class=soc target=_blank href=https://github.com/delirehberi rel=me title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc target=_blank href=https://youtube.com/EmreYILMAZ rel=me title=Youtube><i data-feather=youtube></i></a>
<a class=border></a><a class=soc target=_blank href=https://linkedin.com/in/delirehberi rel=me title=Linkedin><i data-feather=linkedin></i></a>
<a class=border></a><a class=soc target=_blank href=http://blog.emre.xyz/me.vcf rel=me title=VCF><i data-feather=phone></i></a>
<a class=border></a></div><div class=footer-info>2026 delirehberi | built with hugo</div></footer><script>feather.replace()</script></div></body></html>