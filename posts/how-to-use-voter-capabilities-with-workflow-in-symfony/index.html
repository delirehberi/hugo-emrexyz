<!doctype html><html><head lang=en><meta name=lightning content="fallingwhimsy946296@getalby.com"><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>How to use voter capabilities with workflow in symfony - emre.xyz | @delirehberi</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="You need to use a Voter for workflow entity for managing access policies when you use the Workflow component. Workflow component supports access policies with guard option, but the documentation won&rsquo;t point out how to get the subject variable for a voter class."><meta property="og:image" content><meta property="og:url" content="https://blog.emre.xyz/posts/how-to-use-voter-capabilities-with-workflow-in-symfony/"><meta property="og:site_name" content="emre.xyz | @delirehberi"><meta property="og:title" content="How to use voter capabilities with workflow in symfony"><meta property="og:description" content="You need to use a Voter for workflow entity for managing access policies when you use the Workflow component. Workflow component supports access policies with guard option, but the documentation won’t point out how to get the subject variable for a voter class."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-01-15T19:00:00-05:00"><meta property="article:modified_time" content="2020-01-15T19:00:00-05:00"><meta property="article:tag" content="Symfony"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to use voter capabilities with workflow in symfony"><meta name=twitter:description content="You need to use a Voter for workflow entity for managing access policies when you use the Workflow component. Workflow component supports access policies with guard option, but the documentation won’t point out how to get the subject variable for a voter class."><script src=https://blog.emre.xyz/js/feather.min.js></script><link href=https://blog.emre.xyz/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://blog.emre.xyz/css/main.6a0f23ea50fd34b46fee262a5a68e17d458c51a2bc99ba1ba018065de6b180c3.css><link rel=stylesheet type=text/css media=screen href=https://blog.emre.xyz/css/ext.a79633986a21ab3daf02e6ccca6c7d985b6facd4b7dd3520b0c50336cfde916b.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://blog.emre.xyz/css/dark.50b57e12d401420df23965fed157368aba37b76df0ecefd0b1ecd4da664f01a0.css disabled><script async src="https://www.googletagmanager.com/gtag/js?id=G-VLZVJMKPNJ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VLZVJMKPNJ")</script></head><body><div class=content><header><div class=main><a href=https://blog.emre.xyz/>emre.xyz | @delirehberi</a></div><nav><a href=/>main</a>
<a href=https://cal.emre.xyz>cal</a>
<a href=https://nostr.emre.xyz>nostr</a>
<a href=/til>til</a>
<a href=/about>me</a>
<a href=/subscribe>subscribe</a>
<a href=/resume.pdf>resume</a>
| <span id=dark-mode-toggle onclick=toggleTheme()><svg class="feather"><use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#sun"/></svg></span>
<script src=https://blog.emre.xyz/js/themetoggle.js></script><script type=text/javascript src=https://unpkg.com/zapthreads/dist/zapthreads.iife.js></script></nav></header><main><article><div class=post-container><div class=post-content><div class=title><h1 class=title>How to use voter capabilities with workflow in symfony</h1><div class=meta>Posted on Jan 15, 2020</div></div><section class=body><p>You need to use a <a href=https://symfony.com/doc/current/security/voters.html>Voter</a> for workflow entity for managing access policies when you use the <a href=https://symfony.com/doc/current/components/workflow.html>Workflow component</a>. Workflow component supports access policies with guard option, but the documentation won&rsquo;t point out how to get the subject variable for a voter class.</p><p>I faced this situation when I was developing a feature for my last customer. I needed to dig into the workflow component`s code. I found out the class that getting guard config, parsing with expression language, and creating transaction blocker.</p><p>This class is evaluating expression with some variables.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$variables <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;token&#39;</span> <span style=color:#f92672>=&gt;</span> $token,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;user&#39;</span> <span style=color:#f92672>=&gt;</span> $token<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getUser</span>(),
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;subject&#39;</span> <span style=color:#f92672>=&gt;</span> $event<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getSubject</span>(),
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;roles&#39;</span> <span style=color:#f92672>=&gt;</span> $roles,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;role_names&#39;</span> <span style=color:#f92672>=&gt;</span> $roleNames,
</span></span><span style=display:flex><span>            <span style=color:#75715e>// needed for the is_granted expression function
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#e6db74>&#39;auth_checker&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>authorizationChecker</span>,
</span></span><span style=display:flex><span>            <span style=color:#75715e>// needed for the is_* expression function
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#e6db74>&#39;trust_resolver&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>trustResolver</span>,
</span></span><span style=display:flex><span>            <span style=color:#75715e>// needed for the is_valid expression function
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#e6db74>&#39;validator&#39;</span> <span style=color:#f92672>=&gt;</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>validator</span>,
</span></span><span style=display:flex><span>        ];
</span></span></code></pre></div><p>This is our solution, you can use these variables for writing your expression to workflow guard. I needed subject variable and I used to this in transaction configuration:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>        <span style=color:#f92672>to_rejected</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>guard</span>: <span style=color:#e6db74>&#34;is_granted(&#39;reject&#39;,subject)&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>from</span>: <span style=color:#ae81ff>draft</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>to</span>: <span style=color:#ae81ff>rejected</span>
</span></span></code></pre></div><p>Now I can use my voter class with full capabilities.</p><div class=nostr-id><a href=https://njump.me/nevent1qvzqqqr4guq3gamnwvaz7tmjv4kxz7fwv4khyefw0puh5qgkwaehxw309aex2mrp0yhxummnw3ezucnpdejqz9rhwden5te0wfjkccte9ejxzmt4wvhxjmcprpmhxue69uhhyetvv9ujuumwdae8gtnnda3kjctvqyxhwumn8ghj7mn0wvhxcmmvqyt8wumn8ghj7un9d3shjtnswf5k6ctv9ehx2aqppamhxue69uhkummnw3ezumt0d5q3vamnwvaz7tmjv4kxz7fwdehhxtnnda3kjctvqyd8wumn8ghj7ctjw35kxmr9wvhxcctev4erxtnwv4mhxqg7waehxw309akkcuewv94kgetwd9azuetyw5h8gu30dehhxarjqqsvspgxxfs62x3fkgc6mtgtjzmwcsu4c7t5gtup4v3zctppep3nrkgc0yuzt>view in nostr/njump.me</a></div><zap-threads anchor=nevent1qvzqqqr4guq3gamnwvaz7tmjv4kxz7fwv4khyefw0puh5qgkwaehxw309aex2mrp0yhxummnw3ezucnpdejqz9rhwden5te0wfjkccte9ejxzmt4wvhxjmcprpmhxue69uhhyetvv9ujuumwdae8gtnnda3kjctvqyxhwumn8ghj7mn0wvhxcmmvqyt8wumn8ghj7un9d3shjtnswf5k6ctv9ehx2aqppamhxue69uhkummnw3ezumt0d5q3vamnwvaz7tmjv4kxz7fwdehhxtnnda3kjctvqyd8wumn8ghj7ctjw35kxmr9wvhxcctev4erxtnwv4mhxqg7waehxw309akkcuewv94kgetwd9azuetyw5h8gu30dehhxarjqqsvspgxxfs62x3fkgc6mtgtjzmwcsu4c7t5gtup4v3zctppep3nrkgc0yuzt></section><div class=post-tags></div></div></div></article></main><footer><div style=display:flex><a class=soc target=_blank href=https://github.com/delirehberi rel=me title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc target=_blank href=https://youtube.com/EmreYILMAZ rel=me title=Youtube><i data-feather=youtube></i></a>
<a class=border></a><a class=soc target=_blank href=https://linkedin.com/in/delirehberi rel=me title=Linkedin><i data-feather=linkedin></i></a>
<a class=border></a><a class=soc target=_blank href=http://blog.emre.xyz/me.vcf rel=me title=VCF><i data-feather=phone></i></a>
<a class=border></a></div><div class=footer-info>2026 delirehberi | built with hugo</div></footer><script>feather.replace()</script></div></body></html>